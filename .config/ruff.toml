# Python 2.7 and 3.3+ compatibility requirements (using py37 as minimum ruff supports)
target-version = "py37"

# Define Python 2.7 builtins that don't exist in Python 3
builtins = ["unicode"]

line-length = 200

exclude = ["docs"]

[lint]
# Enable most rules
select = [
    "E",    # pycodestyle errors
    "W",    # pycodestyle warnings
    "F",    # Pyflakes
    "I",    # isort
    "S",    # flake8-bandit (security)
    "ERA",  # eradicate (commented-out code)
    "YTT",  # flake8-2020 (sys.version checks)
    "FBT",  # flake8-boolean-trap (boolean positional arguments)
    "A",    # flake8-builtins (shadowing builtins)
    "COM",  # flake8-commas (trailing commas)
    "C4",   # flake8-comprehensions (comprehension improvements)
    "ISC",  # flake8-implicit-str-concat (string concatenation)
    "PYI",  # flake8-pyi (stub file checks)
    "PT",   # flake8-pytest-style (pytest best practices)
]

ignore = [
    "I001",  # Import block unsorted
    "S101",  # Use of assert - intentional for validation and type checking
    "S307",  # Use of eval() - intentional and safe in this codebase (constant folding, validation)
    "FBT002",  # Boolean default positional arguments - API design choice throughout codebase
    "COM812",  # Missing trailing comma - we prohibit trailing commas instead
]

# Per-file ignores for specific compatibility needs
[lint.per-file-ignores]
# AST compatibility module needs star imports and shadows Ellipsis builtin for Python version compatibility
"src/python_minifier/ast_compat.py" = ["F403", "F405", "A001"]

# __init__.py files intentionally re-export for public API
"*/__init__.py" = ["F401"]

# Type comparisons needed for Python 2.7 compatibility in specific files
"src/python_minifier/ast_compare.py" = ["E721"]
"src/python_minifier/rename/rename_literals.py" = ["E721"]
"src/python_minifier/transforms/constant_folding.py" = ["E721"]

# Compatibility imports in utility modules
"src/python_minifier/rename/util.py" = ["F401"]

# Broad exception handling needed for candidate generation (try different quote styles)
"src/python_minifier/f_string.py" = ["S112"]
"src/python_minifier/t_string.py" = ["S112"]

# random.choice() used for variable name generation, not cryptography
"src/python_minifier/rename/name_generator.py" = ["S311"]

# Test files need exec() to validate minified code behavior and subprocess calls for integration tests
"test/**/*.py" = ["S102", "S603"]

# Testing AST constant nodes requires constructing them with boolean literal values
"test/test_is_constant_node.py" = ["FBT003"]

# Hypothesis test generators intentionally use names matching AST concepts (Ellipsis, iter, slice) and use assume(False)
# Comments like # "text{expr}" document string patterns, not commented-out code
"hypo_test/**/*.py" = ["A001", "FBT003", "ERA001"]

# Typing tests intentionally use wrong types, including parameter names that look like passwords
"typing_test/**/*.py" = ["S106"]

[lint.flake8-boolean-trap]
extend-allowed-calls = ["type", "ast.NameConstant", "ast.Constant", "NameConstant", "Constant", "ast_compat.NameConstant", "assume"]

[lint.isort]
force-single-line = false
known-first-party = ["python_minifier"]
